<!DOCTYPE html>

<html>

	<head>
		<title>TicTacToe (PD)</title>

		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
		<link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400" rel="stylesheet">
		<link href="https://fonts.googleapis.com/css?family=Roboto+Condensed" rel="stylesheet">
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
		<script src="http://code.jquery.com/ui/1.9.2/jquery-ui.js"></script>
		<link href="http://maxcdn.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet">
		<link rel="stylesheet" href="style.css" type="text/css" />
	</head>

	<body>

		<script>

			//for two player games, X will go first (on the first game)
			//for one player games, turn will be overwritten
			var turn = 'X';

			//to keep track of what is in each box
			var boxVals = ['', '', '', '', '', '', '', '', ''];

			var wins = [[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]]

			//either 1 or 2
			var numPlayers;

			//for 1 player games, X or O
			var playerTeam;
			var computerTeam;


			// for single player game, is it my turn? Keeps from clicking out of turn
			var isTurn = true;

			//Based on btn clicked, set initial value of turn var
			function pickFirstTurn(str){
				if (str == 'X'){
					turn = 'X';
				} else if (str == 'O'){
					turn = 'O';
				}
			}

			function clearBoard(){
				boxVals = ['', '', '', '', '', '', '', '', '']
				for (var i = 1; i<10; i++){
					$('#box'+i).text('');
				}
				turn = undefined;
			}

			function checkWin(){
				//8 winners are 123, 456, 789, 147, 258, 369, 159, 357
				//must subtract 1 since we are using indexes (makes code cleaner)
				//winners now   012, 345, 678, 036, 147, 258, 048, 246

				if (boxVals[0]==boxVals[1] && boxVals[1]==boxVals[2] && boxVals[0]!= ''){
					console.log('WINNER! '+turn);
					$('#winnerBox').text(turn+' WINS!');
					$('#winnerBox').removeClass('hidden');
					clearBoard();
				}
				else if (boxVals[3]==boxVals[4] && boxVals[4]==boxVals[5] && boxVals[3]!= ''){
					console.log('WINNER! '+turn);
					$('#winnerBox').text(turn+' WINS!');
					$('#winnerBox').removeClass('hidden');
					clearBoard();
				}
				else if (boxVals[6]==boxVals[7] && boxVals[7]==boxVals[8] && boxVals[6]!= ''){
					console.log('WINNER! '+turn);
					$('#winnerBox').text(turn+' WINS!');
					$('#winnerBox').removeClass('hidden');
					clearBoard();
				}
				else if (boxVals[0]==boxVals[3] && boxVals[3]==boxVals[6] && boxVals[0]!= ''){
					console.log('WINNER! '+turn);
					$('#winnerBox').text(turn+' WINS!');
					$('#winnerBox').removeClass('hidden');
					clearBoard();
				}
				else if (boxVals[1]==boxVals[4] && boxVals[4]==boxVals[7] && boxVals[1]!= ''){
					console.log('WINNER! '+turn);
					$('#winnerBox').text(turn+' WINS!');
					$('#winnerBox').removeClass('hidden');
					clearBoard();
				}
				else if (boxVals[2]==boxVals[5] && boxVals[5]==boxVals[8] && boxVals[2]!= ''){
					console.log('WINNER! '+turn);
					$('#winnerBox').text(turn+' WINS!');
					$('#winnerBox').removeClass('hidden');
					clearBoard();
				}
				else if (boxVals[0]==boxVals[4] && boxVals[4]==boxVals[8] && boxVals[0]!= ''){
					console.log('WINNER! '+turn);
					$('#winnerBox').text(turn+' WINS!');
					$('#winnerBox').removeClass('hidden');
					clearBoard();
				}
				else if (boxVals[2]==boxVals[4] && boxVals[4]==boxVals[6] && boxVals[2]!= ''){
					console.log('WINNER! '+turn);
					$('#winnerBox').text(turn+' WINS!');
					$('#winnerBox').removeClass('hidden');
					clearBoard();
				}
			}			

			//After a move, switch turn from X to O or vice versa
			function switchTurn(){
				if (turn == 'X'){
					turn = 'O';
				} else turn = 'X';
			}

			//set a box to be an X or O depending on turn
			//then switches the turn to the other player
			function markBoard(box, team){

				//make sure that it's not an already used box
				if (boxVals[parseInt(box)-1]==''){
					$('#box'+box).text(team);
					
					//set the box vars to the value that is 'written' in them
					boxVals[parseInt(box)-1] = team;
					
					checkWin();
					switchTurn();

					// can't click while isTurn is false
					if (numPlayers==1){
						isTurn == false;
					}

				}
			}


			function computerMove(){
				setTimeout(function() {
					// *** ALGORITHM GOES HERE ***
					
					// 1 WIN
					if (win() != -1){
						markBoard((win()+1).toString(), computerTeam);
						checkWin();
					}

					// 2 BLOCK
					if (block() != -1){
						markBoard((block()+1).toString(), computerTeam);
						checkWin();
					}

					// 3 FORK

					// 4 BLOCK OPPONENT FORK

					// 5 CENTER
					else if (boxVals[4] == ''){
						console.log('center move: '+ 6);
						markBoard('5', computerTeam);
						checkWin();
						switchTurn()
					} 

					// 6 OPPOSITE CORNER
					else if (oppositeCorner()!=-1){
						console.log('opposite corner move: '+ oppositeCorner());
						markBoard((oppositeCorner()+1).toString(), computerTeam);
						checkWin();
						switchTurn()		
					}


					// 7 EMPTY CORNER
					else if (openCorner()!=-1){
						console.log('open corner move: '+ openCorner());
						markBoard((openCorner()+1).toString(), computerTeam);
						checkWin();
						switchTurn()		
					}

					// 8 EMPTY SIDE
					else{
						console.log('side move: '+ side());
						markBoard((side()+1).toString(), computerTeam);
						checkWin();
						switchTurn()		
					}

					// *************

					// now you can click again
					isTurn = true;
				}, 1000);
			}


			// Algorithm Functions
			function win(){

				for (var a = 0; a<wins.length; a++){
				
					var canWin = true;

					// row needs two of computer team characters and the third to be open
					var inRow = 0;

					// is the other teams char taken by one of the numbers in the win?
					for (var b = 0; b<3; b++){

						var activeBox = wins[a][b];

						if (boxVals[activeBox] == computerTeam){
							inRow++;
						}

						if (boxVals[activeBox] == playerTeam){
							canWin = false;
							// console.log('canWin now false')
						}

					}

					// if there is a a place to win, return the board index of the move
					if (canWin && inRow == 2){
						for (var c = 0; c<3; c++){
							if(boxVals[wins[a][c]]==''){
								// console.log([wins[a][c]]);
								return wins[a][c];
							}
						}
					}

				}

				return -1;
			}

			function block(){

				for (var a = 0; a<wins.length; a++){
				
					var canWin = true;

					// row needs two of computer team characters and the third to be open
					var inRow = 0;

					// is the other teams char taken by one of the numbers in the win?
					for (var b = 0; b<3; b++){

						var activeBox = wins[a][b];

						if (boxVals[activeBox] == playerTeam){
							inRow++;
						}

						if (boxVals[activeBox] == computerTeam){
							canWin = false;
							// console.log('canWin now false')
						}

					}

					// if there is a a place to win, return the board index of the move
					if (canWin && inRow == 2){
						for (var c = 0; c<3; c++){
							if(boxVals[wins[a][c]]==''){
								// console.log([wins[a][c]]);
								return wins[a][c];
							}
						}
					}

				}

				return -1;
			}

			function oppositeCorner(){
				if(boxVals[0]==playerTeam && boxVals[2] == ''){
					return 8;
				} else if(boxVals[2]==playerTeam && boxVals[6] == ''){
					return 6;
				} else if(boxVals[6]==playerTeam && boxVals[2] == ''){
					return 2;
				} else if(boxVals[8]==playerTeam && boxVals[0] == ''){
					return 0;
				} 
				return -1;
			}

			function openCorner(){
				if (boxVals[0] == ''){
					return 0;
				} else if (boxVals[2] == ''){
					return 2;
				} else if (boxVals[6] == ''){
					return 6;
				} else if (boxVals[8] == ''){
					return 8;
				} else {
					return -1;	
				}	
			}

			function side(){
				if (boxVals[1] == ''){
					return 1;
				} else if (boxVals[3] == ''){
					return 3;
				} else if (boxVals[5] == ''){
					return 5;
				} else if (boxVals[7] == ''){
					return 7;
				} else {
					return -1;	
				}	
			}				
			

			function menuTwo(){
				$('#numPlayersDiv').addClass('hidden');
				$('#pickTeamDiv').removeClass('hidden');
			}

			function startGame(){
				$('#pickTeamDiv').addClass('hidden');
				$('#numPlayersDiv').addClass('hidden');
				$('#boardDiv').removeClass('hidden');
			}

			function boxBtnAction(str){
				// if only one player, mark their move then have the computer move
				// isTurn keeps player from clicking out of turn

				if (numPlayers == 1 && isTurn){
					markBoard(str, playerTeam);
					computerMove();

					// otherwise just mark the move of whoever's turn it is
				} else{
					markBoard(str, turn);
				} 
			}





			$(document).ready(function() {
				
				// PLAYER TURNS
				
					$('#box1').on('click', function() {boxBtnAction('1')});
					$('#box2').on('click', function() {boxBtnAction('2')});
					$('#box3').on('click', function() {boxBtnAction('3')});
					$('#box4').on('click', function() {boxBtnAction('4')});
					$('#box5').on('click', function() {boxBtnAction('5')});
					$('#box6').on('click', function() {boxBtnAction('6')});
					$('#box7').on('click', function() {boxBtnAction('7')});
					$('#box8').on('click', function() {boxBtnAction('8')});
					$('#box9').on('click', function() {boxBtnAction('9')});

					
				

				// First Turn Buttons
				$('#btnXStarts').on('click', function() {
					turn = 'X';
					playerTeam = 'X';
					computerTeam = 'O';
					pickFirstTurn('X');
					startGame();
				});
				$('#btnOStarts').on('click', function() {
					turn = 'O';
					playerTeam = 'O';
					computerTeam = 'X';
					pickFirstTurn('O');
					startGame();
				});
				$('#btnClear').on('click', function() {clearBoard();});

				// Menu Controls
				$('#btnOnePlayer').on('click', function() {
					numPlayers = 1;
					menuTwo();
				});
				$('#btnTwoPlayers').on('click', function() {
					numPlayers = 2;
					startGame();
				});


			});

		</script>

		<div id="main" class="container">	
			<h1>Tic Tac Toe</h1>

			<h1 id="winnerBox" class="hidden"></h1>

			<div id="boardDiv" class="hidden">
					<button id="box1" class="boxBtn bRight bBottom col col-md-4"></button>
					<button id="box2" class="boxBtn bLeft bBottom bRight col col-md-4"></button>
					<button id="box3" class="boxBtn bLeft bBottom col col-md-4"></button>
					<br>
					<button id="box4" class="boxBtn bTop bRight bBottom col col-md-4"></button>
					<button id="box5" class="boxBtn bTop bRight bLeft bBottom col col-md-4"></button>
					<button id="box6" class="boxBtn bTop bBottom bLeft col col-md-4"></button>
					<br>
					<button id="box7" class="boxBtn bTop bRight col col-md-4"></button>
					<button id="box8" class="boxBtn bTop bRight bLeft col col-md-4"></button>
					<button id="box9" class="boxBtn bTop bLeft col col-md-4"></button>		
			</div>

			<div id="numPlayersDiv" class="">
				<p>How many players?</p>
				<button id="btnOnePlayer">One</button>
				<button id="btnTwoPlayers">Two</button>
			</div>
			<div id="pickTeamDiv" class="hidden">
				<p>Choose your weapon</p>
				<button id="btnXStarts">X</button>
				<button id="btnOStarts">O</button>
			</div>

			<!-- <button id="btnClear">CLEAR</button>  -->
		</div>
		
	</body>

</html>